@model IEnumerable<ApplicationUser>
@{
    ViewData["Title"] = "Index";
    Layout = "~/Views/Shared/_AdminLayout.cshtml";
}

<div id="page-content-wrapper">

 <div class="container-fluid">
     <div class="row justify-content-start">
            <div class="col-10 col-sm-10 col-md-10">
            <h2 class="cheading">Reseller Report</h2>
		</div>
        <div class="col-md-9 col-lg-8">
            <button onclick="downloadPDF()" class="btn btn-success">
               <i class="bi bi-download"></i> Export
			</button>
		</div>
	</div>
    <br /><br />

    <img src="~/images/company.png" id="cof" hidden>

     <label for="count">Total Resellers: @ViewBag.count</label>

    

<table class="table" id="tblData" >
    <thead style="background-color: #232323">
        <tr>
            <th class="text-light">
                First Name
			</th>
             <th class="text-light">
                Surname
			</th>
             <th class="text-light">
                Phone Number
			</th>
             <th class="text-light">
                Email Address
			</th>
		</tr>
	</thead>
    <tbody>
        @foreach(var obj in Model)
        {
            <tr>
                <td>
                    @obj.FirstName                                       
				</td>
                <td>
                    @obj.Surname
                </td>
                <td>
                    @obj.PhoneNumber
                </td>
                <td>
                    @obj.Email
                </td>
			</tr>
        }
    </tbody>

</table>
</div>
</div>
@section Scripts {
    <script src="~/js/notifications.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.6/jspdf.plugin.autotable.min.js"></script>


    <script>

        function downloadPDF() {    
        var header = document.querySelector('#cof'); 
        // var total = document.querySelector('[for="count"]'); TAKE COUNT FROM LABEL??

        var doc = new jsPDF();
        //HEADER
        var width = doc.internal.pageSize.getWidth();
        var height = doc.internal.pageSize.getHeight();
        doc.addImage(header, 'png', 0, 8, width, height-250)

        //TITLE, DATE, PRINTED BY AND COUNT
        doc.setFontSize(18);
        doc.text(13, 60, "RESELLER REPORT");
        doc.setFontSize(8);
        var date = new Date().toLocaleDateString();
        var printedby = "Nomusa Vumisa"; //USER NAME AND SURNAME
        doc.text(160, 66, "DATE PRINTED: " + date);
        doc.text(170, 80, "Total Customers: *"); //PRINT COUNT
   

        //TABLE 
        doc.autoTable( { html: '#tblData', startY:82, headStyles: { fillColor: [35, 35, 35]} });      
        
        //FOOTER, NEED TO ADD PAGE NUMBERS
        doc.setFontSize(10);
        let finalY = doc.autoTable.previous.finalY;
        doc.text(88, finalY+20, "***END OF REPORT***");    
        doc.save('ResellersReport.pdf');}

    </script>

}